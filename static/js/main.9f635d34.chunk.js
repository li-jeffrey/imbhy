(this.webpackJsonpimbhy=this.webpackJsonpimbhy||[]).push([[0],{14:function(e,t,n){},15:function(e,t,n){},17:function(e,t,n){},18:function(e,t,n){},20:function(e,t,n){"use strict";n.r(t);var r=n(4),c=n.n(r),a=n(9),o=n.n(a),s=(n(14),n(1)),u=n(6),i=(n(15),n(0));function d(e){if(""===e.selectedStopId)return Object(i.jsx)("div",{});var t,n=new Date;return t=0===e.etaData.length?Object(i.jsx)("tr",{children:Object(i.jsx)("td",{colSpan:"2",children:"No data"})}):e.etaData.sort((function(e,t){return""===e.eta?1:""===t.eta?-1:new Date(e.eta)-new Date(t.eta)})).map((function(t){var r,c,a=t.rmk_en,o=t.eta;if(""===o)r="Unknown";else{var s=(c=new Date(o)-n,Math.floor(c/6e4));r=s<=0?"<1 min":"".concat(s," min(s)")}var u="".concat(e.selectedRoute,":").concat(e.selectedStopId,":").concat(o);return Object(i.jsxs)("tr",{children:[Object(i.jsx)("td",{children:r},"".concat(u,":eta")),Object(i.jsx)("td",{children:a},"".concat(u,":remark"))]},u)})),Object(i.jsxs)("table",{children:[Object(i.jsx)("thead",{children:Object(i.jsxs)("tr",{children:[Object(i.jsx)("td",{children:"ETA"}),Object(i.jsx)("td",{children:"Remarks"})]})}),Object(i.jsx)("tbody",{children:t})]})}n(17);function l(e){var t=Object(r.useState)({value:"",dropdownOpen:!1,ignoreBlur:!1,items:[]}),n=Object(u.a)(t,2),c=n[0],a=n[1],o=e.items.filter((function(t){return e.shouldItemRender(t,c.value)})).map((function(t){return Object(i.jsx)("div",{className:"dropdown-item",onClick:function(){return function(t){a(Object(s.a)(Object(s.a)({},c),{},{value:t,dropdownOpen:!1})),e.itemSelected(t)}(t)},onTouchStart:function(){return a(Object(s.a)(Object(s.a)({},c),{},{ignoreBlur:!0}))},onMouseEnter:function(){return a(Object(s.a)(Object(s.a)({},c),{},{ignoreBlur:!0}))},onMouseLeave:function(){return a(Object(s.a)(Object(s.a)({},c),{},{ignoreBlur:!1}))},children:t},"dropdown-".concat(t))}));return Object(i.jsxs)("div",{children:[Object(i.jsx)("label",{htmlFor:"route",children:"Route: "}),Object(i.jsx)("input",{type:"text",name:"route",id:"route",placeholder:"Enter a route...",className:"dropdown-input",value:c.value,onChange:function(e){return a(Object(s.a)(Object(s.a)({},c),{},{value:e.target.value}))},onBlur:function(e){c.ignoreBlur||a(Object(s.a)(Object(s.a)({},c),{},{value:e.target.value,dropdownOpen:!1}))},onClick:function(){c.dropdownOpen||a(Object(s.a)(Object(s.a)({},c),{},{dropdownOpen:!0}))},autoComplete:"off"}),c.dropdownOpen&&Object(i.jsx)("div",{className:"dropdown-container",children:o})]})}var p=n(5);n(18);function b(e){var t=Object(r.useState)({value:""}),n=Object(u.a)(t,2),c=n[0],a=n[1];return Object(i.jsxs)("div",{className:"stop-selector-container",children:[Object(i.jsxs)("fieldset",{children:[Object(i.jsx)("label",{htmlFor:"stop",children:"Stop: "}),Object(i.jsx)("select",{id:"stop",name:"Stop",value:c.value,onChange:function(t){return n=t.target.value,a({value:n}),void e.itemSelected(n);var n},children:e.items.map((function(e,t){var n=e.stop,r="".concat(n,"-").concat(t);return Object(i.jsx)("option",{value:n,children:e.name_en},r)}))})]}),Object(i.jsx)("fieldset",{className:"btn-location-container",children:Object(i.jsx)("button",{className:"btn-location",disabled:0===e.items.length,onClick:function(){navigator.geolocation&&navigator.geolocation.getCurrentPosition((function(t){var n=function(e,t,n){var r,c=null,a=1e4,o=Object(p.a)(e);try{for(o.s();!(r=o.n()).done;){var s=r.value,u=parseFloat(s.lat),i=parseFloat(s.long),d=Math.pow(t-u,2)+Math.pow(n-i,2);d<a&&(c=s,a=d)}}catch(l){o.e(l)}finally{o.f()}return c}(e.items,t.coords.latitude,t.coords.longitude);a({value:n.stop})}))},children:Object(i.jsx)("svg",{"aria-hidden":"true",focusable:"false","data-prefix":"fas","data-icon":"map-marker-alt",className:"svg-inline--fa fa-map-marker-alt fa-w-12",role:"img",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 384 512",width:"1.25em",children:Object(i.jsx)("path",{fill:"currentColor",d:"M172.268 501.67C26.97 291.031 0 269.413 0 192 0 85.961 85.961 0 192 0s192 85.961 192 192c0 77.413-26.97 99.031-172.268 309.67-9.535 13.774-29.93 13.773-39.464 0zM192 272c44.183 0 80-35.817 80-80s-35.817-80-80-80-80 35.817-80 80 35.817 80 80 80z"})})})})]})}var f=function(e){var t=e.providers,n=Object(r.useState)({selectedProvider:Object.keys(t)[0],selectedRoute:"",selectedDirection:"outbound",selectedStopId:"",routeData:{},routeStops:[],etaData:[],isLoading:!0,error:null}),c=Object(u.a)(n,2),a=c[0],o=c[1],p=function(e){a.isLoading!==e&&o(Object(s.a)(Object(s.a)({},a),{},{isLoading:e}))},f=function(e){console.error(e.message),o(Object(s.a)(Object(s.a)({},a),{},{error:e}))},j=function(e){var n=t[e.selectedProvider];p(!0),n.getRoutes().then((function(t){h(Object(s.a)(Object(s.a)({},e),{},{routeData:t,selectedRoute:""}))})).catch(f)},h=function(e){var n=t[e.selectedProvider];""!==e.selectedRoute?e.selectedRoute===a.selectedRoute&&e.selectedDirection===a.selectedDirection||(p(!0),n.getStopsByRouteAndBound(e.selectedRoute,e.selectedDirection).then((function(t){return o(Object(s.a)(Object(s.a)({},e),{},{routeStops:t,selectedStopId:"",isLoading:!1}))})).catch(f)):o(Object(s.a)(Object(s.a)({},e),{},{routeStops:[],selectedStopId:"",isLoading:!1}))};return 0===Object.keys(a.routeData).length&&j(a),Object(i.jsxs)("main",{children:[Object(i.jsx)("h1",{children:"Is my bus here yet?"}),Object(i.jsxs)("form",{onSubmit:function(e){e.preventDefault();var n=new FormData(e.target).get("Stop");t[a.selectedProvider].getEtaByRouteAndStopId(a.selectedRoute,n).then((function(e){return o(Object(s.a)(Object(s.a)({},a),{},{selectedStopId:n,etaData:e}))})).catch(f)},children:[Object(i.jsxs)("fieldset",{children:[Object(i.jsx)("label",{htmlFor:"provider",children:"Provider: "}),Object(i.jsx)("select",{id:"provider",name:"Provider",value:a.selectedProvider,onChange:function(e){return j(Object(s.a)(Object(s.a)({},a),{},{selectedProvider:e.target.value}))},children:Object.keys(t).map((function(e){return Object(i.jsx)("option",{value:e,children:e},e)}))})]}),Object(i.jsx)("fieldset",{children:Object(i.jsx)(l,{value:a.selectedRoute,items:Object.keys(a.routeData),shouldItemRender:function(e,t){return e.indexOf(t)>-1},itemSelected:function(e){return h(Object(s.a)(Object(s.a)({},a),{},{selectedRoute:e}))}})}),Object(i.jsxs)("fieldset",{children:[Object(i.jsx)("label",{htmlFor:"direction",children:"Destination: "}),Object(i.jsx)("select",{id:"direction",name:"Direction",value:a.selectedDirection,onChange:function(e){return h(Object(s.a)(Object(s.a)({},a),{},{selectedDirection:e.target.value}))},children:""!==a.selectedRoute&&a.routeData[a.selectedRoute].map((function(e){var t="O"===e.bound?"outbound":"inbound",n="".concat(a.selectedRoute,":").concat(t);return Object(i.jsx)("option",{value:t,children:e.dest_en},n)}))})]}),Object(i.jsx)(b,{items:a.routeStops,itemSelected:function(){o(Object(s.a)(Object(s.a)({},a),{},{selectedStopId:""}))}}),Object(i.jsx)("fieldset",{children:a.isLoading?Object(i.jsx)("button",{type:"submit",disabled:!0,className:"btn-disabled",children:"Loading..."}):Object(i.jsx)("button",{type:"submit",children:""!==a.selectedStopId?"Refresh":"Go"})})]}),a.error&&Object(i.jsx)("div",{className:"warn-text",children:a.error.message}),Object(i.jsx)("hr",{}),Object(i.jsx)(d,{selectedRoute:a.selectedRoute,selectedStopId:a.selectedStopId,etaData:a.etaData})]})},j=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,21)).then((function(t){var n=t.getCLS,r=t.getFID,c=t.getFCP,a=t.getLCP,o=t.getTTFB;n(e),r(e),c(e),a(e),o(e)}))},h=n(2),O=n.n(h),v=n(3);function x(e,t){var n,r={},c=Object(p.a)(e);try{for(c.s();!(n=c.n()).done;){var a=n.value,o=t(a);o in r?r[o].push(a):r[o]=[a]}}catch(s){c.e(s)}finally{c.f()}return r}function m(e,t){var n,r={},c=Object(p.a)(e);try{for(c.s();!(n=c.n()).done;){var a=n.value,o=t(a);if(o in r)throw new Error("Duplicate key: ".concat(o));r[o]=a}}catch(s){c.e(s)}finally{c.f()}return r}var w="https://data.etabus.gov.hk",g=null,y=null;function k(){return(k=Object(v.a)(O.a.mark((function e(){var t,n;return O.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!=g){e.next=11;break}return e.next=3,fetch("".concat(w,"/v1/transport/kmb/route"));case 3:if((t=e.sent).ok){e.next=6;break}throw new Error(t.statusText);case 6:return e.next=8,t.json();case 8:n=(n=e.sent).data.filter((function(e){return"1"===e.service_type})),g=x(n,(function(e){return e.route}));case 11:return e.abrupt("return",g);case 12:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function S(){return R.apply(this,arguments)}function R(){return(R=Object(v.a)(O.a.mark((function e(){var t,n;return O.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!=y){e.next=10;break}return e.next=3,fetch("".concat(w,"/v1/transport/kmb/stop"));case 3:if((t=e.sent).ok){e.next=6;break}throw new Error(t.statusText);case 6:return e.next=8,t.json();case 8:n=e.sent,y=m(n.data,(function(e){return e.stop}));case 10:return e.abrupt("return",y);case 11:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function D(e,t){return B.apply(this,arguments)}function B(){return(B=Object(v.a)(O.a.mark((function e(t,n){var r,c;return O.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch("".concat(w,"/v1/transport/kmb/route-stop/").concat(t,"/").concat(n,"/1"));case 2:if((r=e.sent).ok){e.next=5;break}throw new Error(r.statusText);case 5:return e.next=7,r.json();case 7:return c=e.sent,e.abrupt("return",c.data.map((function(e){return e.stop})));case 9:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function I(){return(I=Object(v.a)(O.a.mark((function e(t,n){var r,c;return O.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,D(t,n);case 2:return r=e.sent,e.next=5,S();case 5:return c=e.sent,e.abrupt("return",r.map((function(e){return c[e]})));case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function _(){return(_=Object(v.a)(O.a.mark((function e(t,n){var r,c;return O.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch("".concat(w,"/v1/transport/kmb/eta/").concat(n,"/").concat(t,"/1"));case 2:if((r=e.sent).ok){e.next=5;break}throw new Error(r.statusText);case 5:return e.next=7,r.json();case 7:return c=e.sent,e.abrupt("return",c.data);case 9:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var C={getRoutes:function(){return k.apply(this,arguments)},getStopsByRouteAndBound:function(e,t){return I.apply(this,arguments)},getEtaByRouteAndStopId:function(e,t){return _.apply(this,arguments)}},E="https://rt.data.gov.hk",T={};function F(){return(F=Object(v.a)(O.a.mark((function e(t){var n,r,c,a,o,s;return O.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t in T){e.next=13;break}return e.next=3,fetch("".concat(E,"/v1/transport/citybus-nwfb/route/").concat(t));case 3:if((n=e.sent).ok){e.next=6;break}throw new Error(n.statusText);case 6:return e.next=8,n.json();case 8:r=e.sent,c=[],a=Object(p.a)(r.data);try{for(a.s();!(o=a.n()).done;)s=o.value,c.push({route:s.route,bound:"O",dest_en:s.dest_en,dest_tc:s.dest_tc,dest_sc:s.dest_sc,service_type:"1"}),c.push({route:s.route,bound:"I",dest_en:s.orig_en,dest_tc:s.orig_tc,dest_sc:s.orig_sc,service_type:"1"})}catch(u){a.e(u)}finally{a.f()}T[t]=x(c,(function(e){return e.route}));case 13:return e.abrupt("return",T[t]);case 14:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function N(e,t,n){return P.apply(this,arguments)}function P(){return(P=Object(v.a)(O.a.mark((function e(t,n,r){var c,a;return O.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch("".concat(E,"/v1/transport/citybus-nwfb/route-stop/").concat(t,"/").concat(n,"/").concat(r));case 2:if((c=e.sent).ok){e.next=5;break}throw new Error(c.statusText);case 5:return e.next=7,c.json();case 7:return a=e.sent,e.abrupt("return",a.data.map((function(e){return e.stop})));case 9:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function L(e){return M.apply(this,arguments)}function M(){return(M=Object(v.a)(O.a.mark((function e(t){var n,r;return O.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch("".concat(E,"/v1/transport/citybus-nwfb/stop/").concat(t));case 2:if((n=e.sent).ok){e.next=5;break}throw new Error(n.statusText);case 5:return e.next=7,n.json();case 7:return r=e.sent,e.abrupt("return",r.data);case 9:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function A(){return(A=Object(v.a)(O.a.mark((function e(t,n,r){var c;return O.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,N(t,n,r);case 2:return c=e.sent,e.next=5,Promise.all(c.map((function(e){return L(e)})));case 5:return e.abrupt("return",e.sent);case 6:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function z(){return(z=Object(v.a)(O.a.mark((function e(t,n,r){var c,a;return O.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch("".concat(E,"/v1/transport/citybus-nwfb/eta/").concat(t,"/").concat(r,"/").concat(n));case 2:if((c=e.sent).ok){e.next=5;break}throw new Error(c.statusText);case 5:return e.next=7,c.json();case 7:return a=e.sent,e.abrupt("return",a.data);case 9:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function J(e){return{getRoutes:function(){return function(e){return F.apply(this,arguments)}(e)},getStopsByRouteAndBound:function(t,n){return function(e,t,n){return A.apply(this,arguments)}(e,t,n)},getEtaByRouteAndStopId:function(t,n){return function(e,t,n){return z.apply(this,arguments)}(e,t,n)}}}var U={NWFB:J("NWFB"),CITYBUS:J("CTB"),KMB:C};o.a.render(Object(i.jsx)(c.a.StrictMode,{children:Object(i.jsx)(f,{providers:U})}),document.getElementById("root")),j()}},[[20,1,2]]]);
//# sourceMappingURL=main.9f635d34.chunk.js.map