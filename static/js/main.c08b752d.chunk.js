(this.webpackJsonpimbhy=this.webpackJsonpimbhy||[]).push([[0],{14:function(e,t,n){},15:function(e,t,n){},17:function(e,t,n){},18:function(e,t,n){},20:function(e,t,n){"use strict";n.r(t);var r=n(4),a=n.n(r),c=n(9),o=n.n(c),s=(n(14),n(1)),u=n(6),i=(n(15),n(0));function d(e){if(""===e.selectedStopId)return Object(i.jsx)("div",{});var t,n=new Date;return t=0===e.etaData.length?Object(i.jsx)("tr",{children:Object(i.jsx)("td",{colSpan:"2",children:"No data"})}):e.etaData.sort((function(e,t){return""===e.eta?1:""===t.eta?-1:new Date(e.eta)-new Date(t.eta)})).map((function(t){var r,a,c=t.rmk_en,o=t.eta;if(""===o)r="Unknown";else{var s=(a=new Date(o)-n,Math.floor(a/6e4));r=s<=0?"<1 min":"".concat(s," min(s)")}var u="".concat(e.selectedRoute,":").concat(e.selectedStopId,":").concat(o);return Object(i.jsxs)("tr",{children:[Object(i.jsx)("td",{children:r},"".concat(u,":eta")),Object(i.jsx)("td",{children:c},"".concat(u,":remark"))]},u)})),Object(i.jsxs)("table",{children:[Object(i.jsx)("thead",{children:Object(i.jsxs)("tr",{children:[Object(i.jsx)("td",{children:"ETA"}),Object(i.jsx)("td",{children:"Remarks"})]})}),Object(i.jsx)("tbody",{children:t})]})}n(17);function l(e){var t=Object(r.useState)({value:"",dropdownOpen:!1,ignoreBlur:!1,items:[]}),n=Object(u.a)(t,2),a=n[0],c=n[1],o=e.items.filter((function(t){return e.shouldItemRender(t,a.value)})).map((function(t){return Object(i.jsx)("div",{className:"dropdown-item",onClick:function(){return function(t){c(Object(s.a)(Object(s.a)({},a),{},{value:t,dropdownOpen:!1})),e.itemSelected(t)}(t)},onTouchStart:function(){return c(Object(s.a)(Object(s.a)({},a),{},{ignoreBlur:!0}))},onMouseEnter:function(){return c(Object(s.a)(Object(s.a)({},a),{},{ignoreBlur:!0}))},onMouseLeave:function(){return c(Object(s.a)(Object(s.a)({},a),{},{ignoreBlur:!1}))},children:t},"dropdown-".concat(t))}));return Object(i.jsxs)("div",{children:[Object(i.jsx)("label",{htmlFor:"route",children:"Route: "}),Object(i.jsx)("input",{type:"text",name:"route",id:"route",placeholder:"Enter a route...",className:"dropdown-input",value:a.value,onChange:function(e){return c(Object(s.a)(Object(s.a)({},a),{},{value:e.target.value}))},onBlur:function(e){a.ignoreBlur||c(Object(s.a)(Object(s.a)({},a),{},{value:e.target.value,dropdownOpen:!1}))},onClick:function(){a.dropdownOpen||c(Object(s.a)(Object(s.a)({},a),{},{dropdownOpen:!0}))},autoComplete:"off"}),a.dropdownOpen&&Object(i.jsx)("div",{className:"dropdown-container",children:o})]})}var p=n(5);n(18);function b(e){var t=Object(r.useState)({value:""}),n=Object(u.a)(t,2),a=n[0],c=n[1];return Object(i.jsxs)("div",{className:"stop-selector-container",children:[Object(i.jsxs)("fieldset",{children:[Object(i.jsx)("label",{htmlFor:"stop",children:"Stop: "}),Object(i.jsx)("select",{id:"stop",name:"Stop",value:a.value,onChange:function(t){return n=t.target.value,c({value:n}),void e.itemSelected(n);var n},children:e.items.map((function(e,t){var n=e.stop,r="".concat(n,"-").concat(t);return Object(i.jsx)("option",{value:n,children:e.name_en},r)}))})]}),Object(i.jsx)("fieldset",{className:"btn-location-container",children:Object(i.jsx)("button",{className:"btn-location",disabled:0===e.items.length,onClick:function(){navigator.geolocation&&navigator.geolocation.getCurrentPosition((function(t){var n=function(e,t,n){var r,a=null,c=1e4,o=Object(p.a)(e);try{for(o.s();!(r=o.n()).done;){var s=r.value,u=parseFloat(s.lat),i=parseFloat(s.long),d=Math.pow(t-u,2)+Math.pow(n-i,2);d<c&&(a=s,c=d)}}catch(l){o.e(l)}finally{o.f()}return a}(e.items,t.coords.latitude,t.coords.longitude);c({value:n.stop})}))},children:Object(i.jsx)("svg",{"aria-hidden":"true",focusable:"false","data-prefix":"fas","data-icon":"map-marker-alt",className:"svg-inline--fa fa-map-marker-alt fa-w-12",role:"img",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 384 512",width:"1.25em",children:Object(i.jsx)("path",{fill:"currentColor",d:"M172.268 501.67C26.97 291.031 0 269.413 0 192 0 85.961 85.961 0 192 0s192 85.961 192 192c0 77.413-26.97 99.031-172.268 309.67-9.535 13.774-29.93 13.773-39.464 0zM192 272c44.183 0 80-35.817 80-80s-35.817-80-80-80-80 35.817-80 80 35.817 80 80 80z"})})})})]})}var f=function(e){var t=e.providers,n=Object(r.useState)({selectedProvider:Object.keys(t)[0],selectedRoute:"",selectedDirection:"outbound",selectedStopId:"",routeData:{},routeStops:[],etaData:[],isLoading:!0,error:null}),a=Object(u.a)(n,2),c=a[0],o=a[1],p=function(e){c.isLoading!==e&&o(Object(s.a)(Object(s.a)({},c),{},{isLoading:e}))},f=function(e){console.error(e.message),o(Object(s.a)(Object(s.a)({},c),{},{error:e}))},j=function(e){var n=t[e.selectedProvider];p(!0),n.getRoutes().then((function(t){h(Object(s.a)(Object(s.a)({},e),{},{routeData:t,selectedRoute:""}))})).catch(f)},h=function(e){var n=t[e.selectedProvider];""!==e.selectedRoute?e.selectedRoute===c.selectedRoute&&e.selectedDirection===c.selectedDirection||(p(!0),n.getStopsByRouteAndBound(e.selectedRoute,e.selectedDirection).then((function(t){return o(Object(s.a)(Object(s.a)({},e),{},{routeStops:t,selectedStopId:"",isLoading:!1}))})).catch(f)):o(Object(s.a)(Object(s.a)({},e),{},{routeStops:[],selectedStopId:"",isLoading:!1}))};return 0===Object.keys(c.routeData).length&&j(c),Object(i.jsxs)("main",{children:[Object(i.jsx)("h1",{children:"Is my bus here yet?"}),Object(i.jsxs)("form",{onSubmit:function(e){e.preventDefault();var n=new FormData(e.target).get("Stop");t[c.selectedProvider].getEtaByRouteAndStopId(c.selectedRoute,n).then((function(e){return o(Object(s.a)(Object(s.a)({},c),{},{selectedStopId:n,etaData:e}))})).catch(f)},children:[Object(i.jsxs)("fieldset",{children:[Object(i.jsx)("label",{htmlFor:"provider",children:"Provider: "}),Object(i.jsx)("select",{id:"provider",name:"Provider",value:c.selectedProvider,onChange:function(e){return j(Object(s.a)(Object(s.a)({},c),{},{selectedProvider:e.target.value}))},children:Object.keys(t).map((function(e){return Object(i.jsx)("option",{value:e,children:e},e)}))})]}),Object(i.jsx)("fieldset",{children:Object(i.jsx)(l,{value:c.selectedRoute,items:Object.keys(c.routeData),shouldItemRender:function(e,t){return e.indexOf(t)>-1},itemSelected:function(e){return h(Object(s.a)(Object(s.a)({},c),{},{selectedRoute:e}))}})}),Object(i.jsxs)("fieldset",{children:[Object(i.jsx)("label",{htmlFor:"direction",children:"Destination: "}),Object(i.jsx)("select",{id:"direction",name:"Direction",value:c.selectedDirection,onChange:function(e){return h(Object(s.a)(Object(s.a)({},c),{},{selectedDirection:e.target.value}))},children:""!==c.selectedRoute&&c.routeData[c.selectedRoute].map((function(e){var t="O"===e.bound?"outbound":"inbound",n="".concat(c.selectedRoute,":").concat(t);return Object(i.jsx)("option",{value:t,children:e.dest_en},n)}))})]}),Object(i.jsx)(b,{items:c.routeStops,itemSelected:function(){o(Object(s.a)(Object(s.a)({},c),{},{selectedStopId:""}))}}),Object(i.jsx)("fieldset",{children:c.isLoading?Object(i.jsx)("button",{type:"submit",disabled:!0,className:"btn-disabled",children:"Loading..."}):Object(i.jsx)("button",{type:"submit",children:""!==c.selectedStopId?"Refresh":"Go"})})]}),c.error&&Object(i.jsx)("div",{className:"warn-text",children:c.error.message}),Object(i.jsx)("hr",{}),Object(i.jsx)(d,{selectedRoute:c.selectedRoute,selectedStopId:c.selectedStopId,etaData:c.etaData})]})},j=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,21)).then((function(t){var n=t.getCLS,r=t.getFID,a=t.getFCP,c=t.getLCP,o=t.getTTFB;n(e),r(e),a(e),c(e),o(e)}))},h=n(2),v=n.n(h),O=n(3);function x(e,t){var n,r={},a=Object(p.a)(e);try{for(a.s();!(n=a.n()).done;){var c=n.value,o=t(c);o in r?r[o].push(c):r[o]=[c]}}catch(s){a.e(s)}finally{a.f()}return r}function m(e,t){var n,r={},a=Object(p.a)(e);try{for(a.s();!(n=a.n()).done;){var c=n.value,o=t(c);if(o in r)throw new Error("Duplicate key: ".concat(o));r[o]=c}}catch(s){a.e(s)}finally{a.f()}return r}var w="https://data.etabus.gov.hk",g=null,k=null;function y(){return(y=Object(O.a)(v.a.mark((function e(){var t,n;return v.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!=g){e.next=11;break}return e.next=3,fetch("".concat(w,"/v1/transport/kmb/route"));case 3:if((t=e.sent).ok){e.next=6;break}throw new Error(t.statusText);case 6:return e.next=8,t.json();case 8:n=(n=e.sent).data.filter((function(e){return"1"===e.service_type})),g=x(n,(function(e){return e.route}));case 11:return e.abrupt("return",g);case 12:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function S(){return R.apply(this,arguments)}function R(){return(R=Object(O.a)(v.a.mark((function e(){var t,n;return v.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!=k){e.next=10;break}return e.next=3,fetch("".concat(w,"/v1/transport/kmb/stop"));case 3:if((t=e.sent).ok){e.next=6;break}throw new Error(t.statusText);case 6:return e.next=8,t.json();case 8:n=e.sent,k=m(n.data,(function(e){return e.stop}));case 10:return e.abrupt("return",k);case 11:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function D(e,t){return B.apply(this,arguments)}function B(){return(B=Object(O.a)(v.a.mark((function e(t,n){var r,a;return v.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch("".concat(w,"/v1/transport/kmb/route-stop/").concat(t,"/").concat(n,"/1"));case 2:if((r=e.sent).ok){e.next=5;break}throw new Error(r.statusText);case 5:return e.next=7,r.json();case 7:return a=e.sent,e.abrupt("return",a.data.map((function(e){return e.stop})));case 9:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function I(){return(I=Object(O.a)(v.a.mark((function e(t,n){var r,a;return v.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,D(t,n);case 2:return r=e.sent,e.next=5,S();case 5:return a=e.sent,e.abrupt("return",r.map((function(e){return a[e]})));case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function _(){return(_=Object(O.a)(v.a.mark((function e(t,n){var r,a;return v.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch("".concat(w,"/v1/transport/kmb/eta/").concat(n,"/").concat(t,"/1"));case 2:if((r=e.sent).ok){e.next=5;break}throw new Error(r.statusText);case 5:return e.next=7,r.json();case 7:return a=e.sent,e.abrupt("return",a.data);case 9:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var C="https://rt.data.gov.hk",E={},T={};function F(){return(F=Object(O.a)(v.a.mark((function e(t){var n,r,a,c,o,s;return v.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t in E){e.next=13;break}return e.next=3,fetch("".concat(C,"/v1/transport/citybus-nwfb/route/").concat(t));case 3:if((n=e.sent).ok){e.next=6;break}throw new Error(n.statusText);case 6:return e.next=8,n.json();case 8:r=e.sent,a=[],c=Object(p.a)(r.data);try{for(c.s();!(o=c.n()).done;)s=o.value,a.push({route:s.route,bound:"O",dest_en:s.dest_en,dest_tc:s.dest_tc,dest_sc:s.dest_sc,service_type:"1"}),a.push({route:s.route,bound:"I",dest_en:s.orig_en,dest_tc:s.orig_tc,dest_sc:s.orig_sc,service_type:"1"})}catch(u){c.e(u)}finally{c.f()}E[t]=x(a,(function(e){return e.route}));case 13:return e.abrupt("return",E[t]);case 14:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function N(e,t,n){return P.apply(this,arguments)}function P(){return(P=Object(O.a)(v.a.mark((function e(t,n,r){var a,c;return v.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch("".concat(C,"/v1/transport/citybus-nwfb/route-stop/").concat(t,"/").concat(n,"/").concat(r));case 2:if((a=e.sent).ok){e.next=5;break}throw new Error(a.statusText);case 5:return e.next=7,a.json();case 7:return c=e.sent,e.abrupt("return",c.data.map((function(e){return e.stop})));case 9:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function L(e){return M.apply(this,arguments)}function M(){return(M=Object(O.a)(v.a.mark((function e(t){var n,r;return v.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t in T){e.next=10;break}return e.next=3,fetch("".concat(C,"/v1/transport/citybus-nwfb/stop/").concat(t));case 3:if((n=e.sent).ok){e.next=6;break}throw new Error(n.statusText);case 6:return e.next=8,n.json();case 8:r=e.sent,T[t]=r.data;case 10:return e.abrupt("return",T[t]);case 11:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function A(){return(A=Object(O.a)(v.a.mark((function e(t,n,r){var a,c,o,s,u;return v.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,N(t,n,r);case 2:a=e.sent,c=[],o=Object(p.a)(a),e.prev=5,o.s();case 7:if((s=o.n()).done){e.next=16;break}return u=s.value,e.t0=c,e.next=12,L(u);case 12:e.t1=e.sent,e.t0.push.call(e.t0,e.t1);case 14:e.next=7;break;case 16:e.next=21;break;case 18:e.prev=18,e.t2=e.catch(5),o.e(e.t2);case 21:return e.prev=21,o.f(),e.finish(21);case 24:return e.abrupt("return",c);case 25:case"end":return e.stop()}}),e,null,[[5,18,21,24]])})))).apply(this,arguments)}function z(){return(z=Object(O.a)(v.a.mark((function e(t,n,r){var a,c;return v.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch("".concat(C,"/v1/transport/citybus-nwfb/eta/").concat(t,"/").concat(r,"/").concat(n));case 2:if((a=e.sent).ok){e.next=5;break}throw new Error(a.statusText);case 5:return e.next=7,a.json();case 7:return c=e.sent,e.abrupt("return",c.data);case 9:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function J(e){return{getRoutes:function(){return function(e){return F.apply(this,arguments)}(e)},getStopsByRouteAndBound:function(t,n){return function(e,t,n){return A.apply(this,arguments)}(e,t,n)},getEtaByRouteAndStopId:function(t,n){return function(e,t,n){return z.apply(this,arguments)}(e,t,n)}}}var U={KMB:{getRoutes:function(){return y.apply(this,arguments)},getStopsByRouteAndBound:function(e,t){return I.apply(this,arguments)},getEtaByRouteAndStopId:function(e,t){return _.apply(this,arguments)}},NWFB:J("NWFB"),CITYBUS:J("CTB")};o.a.render(Object(i.jsx)(a.a.StrictMode,{children:Object(i.jsx)(f,{providers:U})}),document.getElementById("root")),j()}},[[20,1,2]]]);
//# sourceMappingURL=main.c08b752d.chunk.js.map