(this.webpackJsonpimbhy=this.webpackJsonpimbhy||[]).push([[0],{14:function(t,e,n){},15:function(t,e,n){},18:function(t,e,n){"use strict";n.r(e);var r=n(4),c=n.n(r),a=n(8),o=n.n(a),s=(n(14),n(3)),u=n(9),i=(n(15),n(0));function d(t){if(""===t.selectedStopId)return Object(i.jsx)("div",{});var e,n=new Date;return e=0===t.etaData.length?Object(i.jsx)("tr",{children:Object(i.jsx)("td",{colSpan:"2",children:"No data"})}):t.etaData.map((function(e){var r,c=e.rmk_en,a=e.eta,o=(r=new Date(a)-n,Math.floor(r/6e4)),s=o<=0?"<1 min":"".concat(o," min(s)"),u="".concat(t.selectedRoute,":").concat(t.selectedStopId,":").concat(a);return Object(i.jsxs)("tr",{children:[Object(i.jsx)("td",{children:s},"".concat(u,":eta")),Object(i.jsx)("td",{children:c},"".concat(u,":remark"))]},u)})),Object(i.jsxs)("table",{children:[Object(i.jsx)("thead",{children:Object(i.jsxs)("tr",{children:[Object(i.jsx)("td",{children:"ETA"}),Object(i.jsx)("td",{children:"Remarks"})]})}),Object(i.jsx)("tbody",{children:e})]})}var p=function(t){var e=t.providers,n=Object(r.useState)({selectedProvider:Object.keys(e)[0],selectedRoute:"",selectedDirection:"outbound",selectedStopId:"",routeData:[],routeStops:[],etaData:[]}),c=Object(u.a)(n,2),a=c[0],o=c[1],p=function(t){e[t.selectedProvider].getRoutes().then((function(e){l(Object(s.a)(Object(s.a)({},t),{},{routeData:e,selectedRoute:Object.keys(e)[0]}))})).catch((function(t){return console.error(t.message)}))},l=function(t){e[t.selectedProvider].getStopsByRouteAndBound(t.selectedRoute,t.selectedDirection).then((function(e){return o(Object(s.a)(Object(s.a)({},t),{},{routeStops:e,selectedStopId:""}))})).catch((function(t){return console.error(t.message)}))},f=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return function(n){n.preventDefault();var r=Object(s.a)({},a);r[t]=n.target.value,o(r),null!==e&&e(r)}};return 0===a.routeData.length&&p(a),Object(i.jsxs)("main",{children:[Object(i.jsx)("h1",{children:"Is my bus here yet?"}),Object(i.jsxs)("form",{onSubmit:function(t){t.preventDefault();var n=new FormData(t.target).get("Stop");e[a.selectedProvider].getEtaByRouteAndStopId(a.selectedRoute,n).then((function(t){return o(Object(s.a)(Object(s.a)({},a),{},{selectedStopId:n,etaData:t}))})).catch((function(t){return console.error(t.message)}))},children:[Object(i.jsxs)("fieldset",{children:[Object(i.jsx)("label",{htmlFor:"provider",children:"Provider: "}),Object(i.jsx)("select",{id:"provider",name:"Provider",value:a.selectedProvider,onChange:f("selectedProvider",p),children:Object.keys(e).map((function(t){return Object(i.jsx)("option",{value:t,children:t},t)}))})]}),Object(i.jsxs)("fieldset",{children:[Object(i.jsx)("label",{htmlFor:"route",children:"Route: "}),Object(i.jsx)("select",{id:"route",name:"Route",value:a.selectedRoute,onChange:f("selectedRoute",l),children:Object.keys(a.routeData).map((function(t){return Object(i.jsx)("option",{value:t,children:t},t)}))})]}),Object(i.jsxs)("fieldset",{children:[Object(i.jsx)("label",{htmlFor:"direction",children:"Destination: "}),Object(i.jsx)("select",{id:"direction",name:"Direction",value:a.selectedDirection,onChange:f("selectedDirection",l),children:""!==a.selectedRoute&&a.routeData[a.selectedRoute].map((function(t){var e="O"===t.bound?"outbound":"inbound",n="".concat(a.selectedRoute,":").concat(e);return Object(i.jsx)("option",{value:e,children:t.dest_en},n)}))})]}),Object(i.jsxs)("fieldset",{children:[Object(i.jsx)("label",{htmlFor:"stop",children:"Stop: "}),Object(i.jsx)("select",{id:"stop",name:"Stop",onChange:function(){o(Object(s.a)(Object(s.a)({},a),{},{selectedStopId:""}))},children:a.routeStops.map((function(t,e){var n=t.stop,r="".concat(n,"-").concat(e);return Object(i.jsx)("option",{value:n,children:t.name_en},r)}))}),Object(i.jsx)("button",{type:"submit",children:""!==a.selectedStopId?"Refresh":"Go"})]})]}),Object(i.jsx)("hr",{}),Object(i.jsx)(d,{selectedRoute:a.selectedRoute,selectedStopId:a.selectedStopId,etaData:a.etaData})]})},l=function(t){t&&t instanceof Function&&n.e(3).then(n.bind(null,19)).then((function(e){var n=e.getCLS,r=e.getFID,c=e.getFCP,a=e.getLCP,o=e.getTTFB;n(t),r(t),c(t),a(t),o(t)}))},f=n(1),b=n.n(f),h=n(2),j=n(5);function x(t,e){var n,r={},c=Object(j.a)(t);try{for(c.s();!(n=c.n()).done;){var a=n.value,o=e(a);o in r?r[o].push(a):r[o]=[a]}}catch(s){c.e(s)}finally{c.f()}return r}function v(t,e){var n,r={},c=Object(j.a)(t);try{for(c.s();!(n=c.n()).done;){var a=n.value,o=e(a);if(o in r)throw new Error("Duplicate key: ".concat(o));r[o]=a}}catch(s){c.e(s)}finally{c.f()}return r}var O="https://data.etabus.gov.hk",y=null,k=null;function m(){return(m=Object(h.a)(b.a.mark((function t(){var e,n;return b.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(null!=y){t.next=11;break}return t.next=3,fetch("".concat(O,"/v1/transport/kmb/route"));case 3:if((e=t.sent).ok){t.next=6;break}throw new Error(e.statusText);case 6:return t.next=8,e.json();case 8:n=(n=t.sent).data.filter((function(t){return"1"===t.service_type})),y=x(n,(function(t){return t.route}));case 11:return t.abrupt("return",y);case 12:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function w(){return g.apply(this,arguments)}function g(){return(g=Object(h.a)(b.a.mark((function t(){var e,n;return b.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(null!=k){t.next=10;break}return t.next=3,fetch("".concat(O,"/v1/transport/kmb/stop"));case 3:if((e=t.sent).ok){t.next=6;break}throw new Error(e.statusText);case 6:return t.next=8,e.json();case 8:n=t.sent,k=v(n.data,(function(t){return t.stop}));case 10:return t.abrupt("return",k);case 11:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function S(t,e){return R.apply(this,arguments)}function R(){return(R=Object(h.a)(b.a.mark((function t(e,n){var r,c;return b.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,fetch("".concat(O,"/v1/transport/kmb/route-stop/").concat(e,"/").concat(n,"/1"));case 2:if((r=t.sent).ok){t.next=5;break}throw new Error(r.statusText);case 5:return t.next=7,r.json();case 7:return c=t.sent,t.abrupt("return",c.data.map((function(t){return t.stop})));case 9:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function D(){return(D=Object(h.a)(b.a.mark((function t(e,n){var r,c;return b.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,S(e,n);case 2:return r=t.sent,t.next=5,w();case 5:return c=t.sent,t.abrupt("return",r.map((function(t){return c[t]})));case 7:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function _(){return(_=Object(h.a)(b.a.mark((function t(e,n){var r,c;return b.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,fetch("".concat(O,"/v1/transport/kmb/eta/").concat(n,"/").concat(e,"/1"));case 2:if((r=t.sent).ok){t.next=5;break}throw new Error(r.statusText);case 5:return t.next=7,r.json();case 7:return c=t.sent,t.abrupt("return",c.data);case 9:case"end":return t.stop()}}),t)})))).apply(this,arguments)}var I="https://rt.data.gov.hk",B={},E={};function T(){return(T=Object(h.a)(b.a.mark((function t(e){var n,r,c,a,o,s;return b.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e in B){t.next=13;break}return t.next=3,fetch("".concat(I,"/v1/transport/citybus-nwfb/route/").concat(e));case 3:if((n=t.sent).ok){t.next=6;break}throw new Error(n.statusText);case 6:return t.next=8,n.json();case 8:r=t.sent,c=[],a=Object(j.a)(r.data);try{for(a.s();!(o=a.n()).done;)s=o.value,c.push({route:s.route,bound:"O",dest_en:s.dest_en,dest_tc:s.dest_tc,dest_sc:s.dest_sc,service_type:"1"}),c.push({route:s.route,bound:"I",dest_en:s.orig_en,dest_tc:s.orig_tc,dest_sc:s.orig_sc,service_type:"1"})}catch(u){a.e(u)}finally{a.f()}B[e]=x(c,(function(t){return t.route}));case 13:return t.abrupt("return",B[e]);case 14:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function F(t,e,n){return P.apply(this,arguments)}function P(){return(P=Object(h.a)(b.a.mark((function t(e,n,r){var c,a;return b.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,fetch("".concat(I,"/v1/transport/citybus-nwfb/route-stop/").concat(e,"/").concat(n,"/").concat(r));case 2:if((c=t.sent).ok){t.next=5;break}throw new Error(c.statusText);case 5:return t.next=7,c.json();case 7:return a=t.sent,t.abrupt("return",a.data.map((function(t){return t.stop})));case 9:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function C(t){return A.apply(this,arguments)}function A(){return(A=Object(h.a)(b.a.mark((function t(e){var n,r;return b.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e in E){t.next=10;break}return t.next=3,fetch("".concat(I,"/v1/transport/citybus-nwfb/stop/").concat(e));case 3:if((n=t.sent).ok){t.next=6;break}throw new Error(n.statusText);case 6:return t.next=8,n.json();case 8:r=t.sent,E[e]=r.data;case 10:return t.abrupt("return",E[e]);case 11:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function M(){return(M=Object(h.a)(b.a.mark((function t(e,n,r){var c,a,o,s,u;return b.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,F(e,n,r);case 2:c=t.sent,a=[],o=Object(j.a)(c),t.prev=5,o.s();case 7:if((s=o.n()).done){t.next=16;break}return u=s.value,t.t0=a,t.next=12,C(u);case 12:t.t1=t.sent,t.t0.push.call(t.t0,t.t1);case 14:t.next=7;break;case 16:t.next=21;break;case 18:t.prev=18,t.t2=t.catch(5),o.e(t.t2);case 21:return t.prev=21,o.f(),t.finish(21);case 24:return t.abrupt("return",a);case 25:case"end":return t.stop()}}),t,null,[[5,18,21,24]])})))).apply(this,arguments)}function N(){return(N=Object(h.a)(b.a.mark((function t(e,n,r){var c,a;return b.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,fetch("".concat(I,"/v1/transport/citybus-nwfb/eta/").concat(e,"/").concat(r,"/").concat(n));case 2:if((c=t.sent).ok){t.next=5;break}throw new Error(c.statusText);case 5:return t.next=7,c.json();case 7:return a=t.sent,t.abrupt("return",a.data);case 9:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function J(t){return{getRoutes:function(){return function(t){return T.apply(this,arguments)}(t)},getStopsByRouteAndBound:function(e,n){return function(t,e,n){return M.apply(this,arguments)}(t,e,n)},getEtaByRouteAndStopId:function(e,n){return function(t,e,n){return N.apply(this,arguments)}(t,e,n)}}}var L={KMB:{getRoutes:function(){return m.apply(this,arguments)},getStopsByRouteAndBound:function(t,e){return D.apply(this,arguments)},getEtaByRouteAndStopId:function(t,e){return _.apply(this,arguments)}},NWFB:J("NWFB"),CITYBUS:J("CTB")};o.a.render(Object(i.jsx)(c.a.StrictMode,{children:Object(i.jsx)(p,{providers:L})}),document.getElementById("root")),l()}},[[18,1,2]]]);
//# sourceMappingURL=main.56a9679e.chunk.js.map